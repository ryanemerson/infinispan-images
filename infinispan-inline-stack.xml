<infinispan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:infinispan:config:10.0 http://www.infinispan.org/schemas/infinispan-config-10.0.xsd
                                urn:infinispan:server:10.0 http://www.infinispan.org/schemas/infinispan-server-10.0.xsd" xmlns="urn:infinispan:config:10.0" xmlns:server="urn:infinispan:server:10.0">

    <jgroups>
        <stack name="kube-tcp">
            <TCP bind_addr="${jgroups.bind.address,jgroups.tcp.address:SITE_LOCAL}" bind_port="7800" thread_naming_pattern="pl" send_buf_size="640k" sock_conn_timeout="300" bundler_type="no-bundler" port_range="0" thread_pool.min_threads="0" thread_pool.max_threads="200" thread_pool.keep_alive_time="60000" />

            <dns.DNS_PING dns_query="${jgroups.dns.query}" dns_record_type="A" />

            <MERGE3 min_interval="10000" max_interval="30000" />
            <FD_SOCK client_bind_port="57600" start_port="57600" />
            <!-- Suspect node `timeout` to `timeout + timeout_check_interval` millis after the last heartbeat -->
            <FD_ALL timeout="10000" interval="2000" timeout_check_interval="1000" />
            <VERIFY_SUSPECT timeout="1000" />
            <pbcast.NAKACK2 use_mcast_xmit="false" xmit_interval="100" xmit_table_num_rows="50" xmit_table_msgs_per_row="1024" xmit_table_max_compaction_time="30000" resend_last_seqno="true" />
            <UNICAST3 xmit_interval="100" xmit_table_num_rows="50" xmit_table_msgs_per_row="1024" xmit_table_max_compaction_time="30000" />
            <pbcast.STABLE stability_delay="500" desired_avg_gossip="5000" max_bytes="1M" />
            <pbcast.GMS print_local_addr="false" join_timeout="5000" />
            <UFC_NB max_credits="3m" min_threshold="0.40" />
            <MFC_NB max_credits="3m" min_threshold="0.40" />
            <FRAG3 />
        </stack>
    </jgroups>

    <cache-container name="clustered" statistics="true">
        <transport cluster="infinispan" stack="kube-tcp" />

        <distributed-cache owners="3" mode="SYNC" remote-timeout="15000" name="devices">
            <locking isolation="READ_COMMITTED" />
            <indexing index="PRIMARY_OWNER">
                <property name="default.indexmanager">
                               org.infinispan.query.indexmanager.InfinispanIndexManager
                   </property>
            </indexing>
        </distributed-cache>

        <distributed-cache owners="3" mode="SYNC" remote-timeout="15000" name="adapterCredentials">
            <transaction mode="NONE" />
            <indexing index="NONE" />
        </distributed-cache>

        <distributed-cache owners="3" mode="SYNC" remote-timeout="15000" name="deviceStates">
            <transaction mode="NONE" />
            <indexing index="NONE" />
        </distributed-cache>
    </cache-container>

    <server xmlns="urn:infinispan:server:10.0">
        <interfaces>
            <interface name="public">
                <inet-address value="${infinispan.bind.address:127.0.0.1}" />
            </interface>
        </interfaces>

        <socket-bindings default-interface="public" port-offset="${infinispan.socket.binding.port-offset:0}">
            <socket-binding name="default" port="${infinispan.bind.port:11222}" />
        </socket-bindings>

        <security>
            <security-realms>
                <security-realm name="default">
                    <properties-realm groups-attribute="Roles">
                        <user-properties path="users.properties" relative-to="infinispan.server.config.path" />
                        <group-properties path="groups.properties" relative-to="infinispan.server.config.path" />
                    </properties-realm>
                </security-realm>
            </security-realms>
        </security>

        <endpoints socket-binding="default" security-realm="default">
            <hotrod-connector name="hotrod">
                <authentication security-realm="default">
                    <sasl mechanisms="SCRAM-SHA-512 SCRAM-SHA-384 SCRAM-SHA-256 SCRAM-SHA-1 DIGEST-SHA-512 DIGEST-SHA-384 DIGEST-SHA-256 DIGEST-SHA DIGEST-MD5 CRAM-MD5 PLAIN" qop="auth" server-name="infinispan">
                        <property name="com.sun.security.sasl.digest.realm">
                        default
                      </property>
                    </sasl>
                </authentication>
            </hotrod-connector>
            <rest-connector name="rest">
                <authentication mechanisms="DIGEST" security-realm="default" />
            </rest-connector>
        </endpoints>
    </server>
</infinispan>